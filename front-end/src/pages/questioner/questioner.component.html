<div class="row-container">
  <div class="header-Primary">
    <div class="primary-details">
      <div class="detail-item">
        <span class="label">Name: {{ primaryDetails?.name }}</span>
      </div>
      <div class="detail-item">
        <span class="label">Email: {{ primaryDetails?.email }}</span>
      </div>
      <div class="detail-item">
        <span class="label">Contact no: {{ primaryDetails?.phone }}</span>
      </div>
      <div class="status-column">
        <h6 class="label">Status</h6>
        <div class="value">
          <select class="status-dropdown" [(ngModel)]="selectedStatusId">
            <option *ngFor="let status of statuses" [value]="status.st_id">{{ status.st_name }}</option>
          </select>
          <button (click)="updateStatus(resumeId || '')" [disabled]="!resumeId || !selectedStatusId">Update Status</button>
        </div>
        <!-- <div *ngIf="resumeStatus">
          <p>Current Status: {{ resumeStatus.st_name }}</p>
        </div> -->
      </div>
    </div>



    <div class="questions">
    <!-- JD Question Generator Section -->
    <div class="jd-question-section">
      <div class="jd-questions-container">
        <button class="btn btn-icon" (click)="toggleJDQuestions()">
          <i class="pi" [ngClass]="isJDQuestionsVisible ? 'pi-chevron-up' : 'pi-chevron-down'"></i>
        </button>
        <h4>JD Based Questions</h4>
        <button class="btn btn-secondary" (click)="isJDGenerated ? regenerateJDQuestions() : generateJDQuestions(jdId)">
          {{ isJDGenerated ? 'Regenerate' : 'Generate' }}
        </button>
      </div>
      <div class="faq-item" *ngIf="isJDQuestionsVisible">
        <div *ngIf="isLoadingJD" class="loader">
          <p-skeleton styleClass="mb-2"></p-skeleton>
          <p-skeleton width="10rem" styleClass="mb-2"></p-skeleton>
          <p-skeleton width="5rem" class="mb-2"></p-skeleton>
          <p-skeleton height="2rem" class="mb-2"></p-skeleton>
          <p-skeleton width="10rem" height="4rem"></p-skeleton>
        </div>
        <p-accordion *ngIf="!isLoadingJD">
          <p-accordionTab *ngFor="let question of jdQuestions">
            <ng-template pTemplate="header">
              <span style="color: rgb(51, 51, 51); font-weight: 500; text-decoration: none;">
                {{ question.question }}
              </span>
            </ng-template>
            <p>{{ question.answer }}</p>
          </p-accordionTab>
        </p-accordion>
      </div>
    </div>
  </div>
  
    <!-- Resume Question Generator Section -->
    <div class="resume-question-section">
      <div class="resume-questions-container">
        <button class="btn btn-icon" (click)="toggleResumeQuestions()">
          <i class="pi" [ngClass]="isResumeQuestionsVisible ? 'pi-chevron-up' : 'pi-chevron-down'"></i>
        </button>
        <h4>Resume Based Questions</h4>
        <button class="btn btn-secondary" (click)="isResumeGenerated ? regenerateResumeQuestions() : generateResumeQuestions(resumeId)">
          {{ isResumeGenerated ? 'Regenerate' : 'Generate' }}
        </button>
      </div>
      <div class="faq-item" *ngIf="isResumeQuestionsVisible">
        <div *ngIf="isLoadingResume" class="loader">
          <p-skeleton styleClass="mb-2"></p-skeleton>
          <p-skeleton width="10rem" styleClass="mb-2"></p-skeleton>
          <p-skeleton width="5rem" class="mb-2"></p-skeleton>
          <p-skeleton height="2rem" class="mb-2"></p-skeleton>
          <p-skeleton width="10rem" height="4rem"></p-skeleton>
        </div>
        <p-accordion *ngIf="!isLoadingResume">
          <p-accordionTab *ngFor="let question of resumeQuestions">
            <ng-template pTemplate="header">
              <span style="color: rgb(51, 51, 51); font-weight: 500;">
                {{ question.question }}
              </span>
            </ng-template>
            <p>{{ question.answer }}</p>
          </p-accordionTab>
        </p-accordion>
      </div>
    </div>
  </div>


  

  <!-- Resume Viewer Section -->
  <div class="resume-viewer">
    <div class="header">
      <button class="tab-button" [class.active]="activeTab === 'resume-summary'" (click)="setActiveTab('resume-summary')">Resume View</button>
      <button class="tab-button" [class.active]="activeTab === 'resume'" (click)="setActiveTab('resume')">JD View</button>
    </div>

    <!-- Resume View Content -->
    <div class="tab-content" *ngIf="activeTab === 'resume-summary'">
      <div class="resume-content">
        <!-- Zoom Controls -->
        <div class="controls">
          <button (click)="zoomOut()">-</button>
          <span>Zoom: {{ zoomLevel * 100 | number : '1.0-0' }}%</span>
          <button (click)="zoomIn()">+</button>
        </div>

        <div *ngIf="isPdfFile && resumeS3Link">
          <pdf-viewer [src]="resumeS3Link" [original-size]="false" [show-all]="true" [zoom]="zoomLevel" style="height: 500px; width: 100%"></pdf-viewer>
        </div>
        <div *ngIf="isDocxFile && resumeS3Link">
          <ngx-doc-viewer [url]="resumeS3Link" viewer="google" style="width: 100%; height: 500px;"></ngx-doc-viewer>
        </div>
        <ng-template #loadingResume>
          <p>Loading resume...</p>
        </ng-template>
      </div>
    </div>

    <!-- JD View Content -->
    <div class="tab-content" *ngIf="activeTab === 'resume'">
      <div class="job-description-template">
        <div class="controls">
          <button (click)="zoomOut()">-</button>
          <span>Zoom: {{ zoomLevel * 100 | number : '1.0-0' }}%</span>
          <button (click)="zoomIn()">+</button>
        </div>

        <div *ngIf="isPdfFile && positionS3Link">
          <pdf-viewer [src]="positionS3Link" [original-size]="false" [show-all]="true" [zoom]="zoomLevel" style="height: 500px; width: 100%"></pdf-viewer>
        </div>
        <div *ngIf="isDocxFile && positionS3Link">
          <ngx-doc-viewer [url]="positionS3Link" viewer="google" style="width: 100%; height: 500px;"></ngx-doc-viewer>
        </div>
        <ng-template #loadingJD>
          <p>Loading job description...</p>
        </ng-template>
      </div>
    </div>

    <!-- Router Outlet -->
    <div class="p-4 mt-5" style="padding-top: 100px">
      <router-outlet></router-outlet>
    </div>
  </div>

  <button (click)="resumelist()" class="resume-back">Back to Question Page</button>
</div>
